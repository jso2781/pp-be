<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.go.kids.domain.pst.mapper.PstMapper">

    <select id="selectPstList" parameterType="PstPVO" resultType="PstRVO" >
        /* 대국민포털_게시물기본 목록 조회 (PstMapper.selectPstList) */
        SELECT
             p.pst_sn
            ,p.bbs_id
            ,p.pst_ttl
            ,p.pst_cn
            ,p.pst_inq_cnt
            ,p.fix_yn
            ,p.wrtr_dept_nm
            ,p.mdfr_dept_nm
            ,p.rgtr_id
            ,p.reg_dt
			,p.vdo_url_addr as video_id
            ,p.mdfr_id
            ,p.mdfcn_dt
        	,f.file_nm as thmb_file_nm        
		    ,f.file_strg_path_dsctn as thmb_file_path
        FROM kids_own.TB_PP_M_PST p
        LEFT OUTER JOIN kids_own.TB_CA_E_FILE_TRSM f
          ON p.thmb_id = f.atch_file_group_id
       WHERE p.bbs_id = #{bbsId}
	<if test="searchWrd != null and searchWrd != ''">
	  <choose>
	    <when test="searchCnd == 'title'">
	      AND p.pst_ttl LIKE '%' || #{searchWrd} || '%'
	    </when>
	    <when test="searchCnd == 'content'">
	      AND p.pst_cn LIKE '%' || #{searchWrd} || '%'
	    </when>
	  </choose>
	</if>				
       ORDER BY p.reg_dt DESC 
    </select>

    <select id="getPst" parameterType="PstPVO" resultType="PstRVO" >
        /* 대국민포털_게시물기본 조회 (PstMapper.getPst) */
        SELECT
             p.pst_sn
            ,p.bbs_id
            ,p.pst_ttl
            ,p.pst_cn
            ,p.pst_inq_cnt
            ,p.pst_kogl_cprgt_type_cd
            ,p.atch_file_group_id
            ,p.thmb_id
            ,p.fix_yn
            ,p.wrtr_dept_nm
            ,p.mdfr_dept_nm
            ,p.rgtr_id
            ,p.reg_dt
			,p.vdo_url_addr as video_id
            ,p.mdfr_id
            ,p.mdfcn_dt
        	,f.file_nm as img_file_nm        
		    ,f.file_strg_path_dsctn as img_file_path
        FROM kids_own.TB_PP_M_PST p
        LEFT OUTER JOIN kids_own.TB_CA_E_FILE_TRSM f
          ON p.atch_file_group_id = f.atch_file_group_id
       WHERE p.bbs_id = #{bbsId}
         AND p.pst_sn = #{pstSn}
    </select>
    
    <update id="updtInqCnt" parameterType="PstPVO">
        /* 대국민포털_게시물기본 조회수 증가 (PstMapper.updtInqCnt) */
        UPDATE kids_own.TB_PP_M_PST
        SET pst_inq_cnt = COALESCE(pst_inq_cnt, 0) + 1
        WHERE bbs_id = #{bbsId}		
        AND pst_sn = #{pstSn}
    </update>    

</mapper>