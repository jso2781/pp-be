<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.go.kids.domain.main.mapper.MainMapper">

    <select id="selectRecent4PstListByTaskCd" parameterType="String" resultType="MainRVO" >
        /* 대국민포털_메인화면 최근 게시물 조회 (SNS 및 홍보존) (MainMapper.selectRecent4PstListByTaskCd) */
		SELECT
		     p.pst_sn
		    ,p.bbs_id
		    ,p.pst_ttl
		    ,p.thmb_id
        	,f.file_nm as thmb_file_nm        
		    ,f.file_strg_path_dsctn as thmb_file_path		    
		    ,p.reg_dt
		    ,p.pst_cn
		    ,p.vdo_url_addr as video_id
		FROM kids_own.TB_PP_M_PST p
		LEFT OUTER JOIN kids_own.TB_CA_E_FILE_TRSM f
		       ON p.thmb_id = f.atch_file_group_id
	   WHERE p.bbs_id = (SELECT task_cd_vl
		          		   FROM kids_own.TB_PP_M_TASK_CD
		         		  WHERE task_cd = #{taskCd})
	   ORDER BY p.reg_dt DESC
	   LIMIT 4       
    </select>
    
	<select id="selectRecent20PstListByTaskCds" resultType="MainRVO">
		/* 대국민포털_메인화면 최근 게시물 조회 (SNS 통합) (MainMapper.selectRecent20PstListByTaskCds) */
	    SELECT
	         p.pst_sn
	        ,p.bbs_id
	        ,p.pst_ttl
	        ,p.thmb_id	        
        	,f.file_nm as thmb_file_nm        
		    ,f.file_strg_path_dsctn as thmb_file_path	        	        
	        ,p.reg_dt
	        ,p.pst_cn
	        ,p.vdo_url_addr as video_id
		    ,t.task_cd
			,CASE t.task_cd
			 WHEN 'MN_BBS2' THEN '유튜브'
			 WHEN 'MN_BBS3' THEN '인스타'
			 WHEN 'MN_BBS4' THEN '블로그'
			 ELSE '기타'
			  END AS sns_type
		FROM kids_own.TB_PP_M_TASK_CD t
		LEFT JOIN kids_own.TB_PP_M_PST p
		  ON t.task_cd_vl = p.bbs_id
		LEFT JOIN kids_own.TB_CA_E_FILE_TRSM f
		  ON p.thmb_id = f.atch_file_group_id
	    WHERE t.task_cd IN
	            <foreach collection="taskCdList"
	                     item="taskCd"
	                     open="("
	                     separator=","
	                     close=")">
	                #{taskCd}
	            </foreach>
	    ORDER BY p.reg_dt DESC
	    LIMIT 20
	</select>    
    
    <select id="selectRecent5PstListByTaskCd" parameterType="String" resultType="MainRVO" >
        /* 대국민포털_메인화면 최근 게시물 조회 (MainMapper.selectRecent5PstListByTaskCd) */
		SELECT
		     p.pst_sn
		    ,p.bbs_id
		    ,p.pst_ttl
		    ,p.thmb_id
        	,f.file_nm as thmb_file_nm        
		    ,f.file_strg_path_dsctn as thmb_file_path	       
		    ,p.reg_dt
		FROM kids_own.TB_PP_M_PST p
		LEFT OUTER JOIN kids_own.TB_CA_E_FILE_TRSM f
		       ON p.thmb_id = f.atch_file_group_id
	   WHERE p.bbs_id = (SELECT task_cd_vl
						   FROM kids_own.TB_PP_M_TASK_CD
						  WHERE task_cd = #{taskCd})
		ORDER BY p.reg_dt DESC
	   LIMIT 5       
    </select>    
    
    <select id="selectPopupList" resultType="MainRVO" >
        /* 대국민포털_메인화면 팝업 목록 조회 (MainMapper.selectPopupList) */
		SELECT p.popup_ttl
		     , p.popup_lnkg_addr
		     , a.file_nm as thmb_file_nm      
		     , a.file_strg_path_dsctn as thmb_file_path	 
		  FROM kids_own.TB_PP_M_POPUP p
		  LEFT OUTER JOIN kids_own.TB_CA_E_FILE_TRSM a
		    ON p.atch_file_group_id = a.atch_file_group_id
		 WHERE p.popup_pstg_yn = 'Y'
		<![CDATA[    
		   AND (p.popup_pstg_bgng_dt <= CURRENT_TIMESTAMP
		        AND
		        p.popup_pstg_end_dt >= CURRENT_TIMESTAMP)     
		]]>		 
		 ORDER BY p.popup_seq
    </select>        

</mapper>