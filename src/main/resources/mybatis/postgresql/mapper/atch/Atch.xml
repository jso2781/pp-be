<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.go.kids.domain.atch.mapper.AtchMapper">

    <select id="getAtch" parameterType="AtchPVO" resultType="AtchRVO" >
        /* 공통_첨부파일기본 조회 (AtchMapper.getAtch) */
        SELECT
             atch_file_sn
            ,menu_sn
            ,menu_type
            ,atch_file_uld_hr
            ,atch_file_use_yn
            ,atch_file_path
            ,atch_file_nm
            ,atch_file_extn_nm
            ,atch_file_cn
            ,atch_file_sz
            ,rgtr_id
            ,reg_dt

            ,mdfr_id
            ,mdfcn_dt

        FROM kids_own.TB_CA_M_ATCH
        WHERE 1=1
        AND atch_file_sn = #{atchFileSn}
    </select>

    <select id="nextAtchFileSn" resultType="long">
        SELECT nextval('TB_CA_M_ATCH_SEQ')
    </select>

    <insert id="insertAtch" parameterType="AtchPVO">
        /* 공통_첨부파일기본 입력 (AtchMapper.insertAtch) */
        INSERT INTO kids_own.TB_CA_M_ATCH
        (
             atch_file_sn
            ,menu_sn
            ,menu_type
            ,atch_file_uld_hr
            ,atch_file_use_yn
            ,atch_file_path
            ,atch_file_nm
            ,atch_file_extn_nm
            ,atch_file_cn
            ,atch_file_sz
            ,rgtr_id
            ,reg_dt

            ,mdfr_id
            ,mdfcn_dt

        )
        VALUES
        (
             #{atchFileSn}
            ,#{menuSn}
            ,#{menuType}
            ,#{atchFileUldHr}
            ,#{atchFileUseYn}
            ,#{atchFilePath}
            ,#{atchFileNm}
            ,#{atchFileExtnNm}
            ,#{atchFileCn}
            ,#{atchFileSz}
            ,#{rgtrId}
            ,now()

            ,#{mdfrId}
            ,now()

        )
    </insert>

    <update id="updateAtch" parameterType="AtchPVO">
        /* 공통_첨부파일기본 수정 (AtchMapper.updateAtch) */
        UPDATE kids_own.TB_CA_M_ATCH
        SET
             menu_sn = coalesce(#{menuSn}, menu_sn)
            ,menu_type = coalesce(#{menuType}, menu_type)
            ,atch_file_uld_hr = coalesce(#{atchFileUldHr}, atch_file_uld_hr)
            ,atch_file_use_yn = coalesce(#{atchFileUseYn}, atch_file_use_yn)
            ,atch_file_path = coalesce(#{atchFilePath}, atch_file_path)
            ,atch_file_nm = coalesce(#{atchFileNm}, atch_file_nm)
            ,atch_file_extn_nm = coalesce(#{atchFileExtnNm}, atch_file_extn_nm)
            ,atch_file_cn = coalesce(#{atchFileCn}, atch_file_cn)
            ,atch_file_sz = coalesce(#{atchFileSz}, atch_file_sz)
            ,mdfr_id = coalesce(#{mdfrId}, mdfr_id)
            ,mdfcn_dt = now()

        WHERE 1=1
        AND atch_file_sn = #{atchFileSn}
    </update>

    <insert id="saveAtch" parameterType="AtchPVO">
        /* 공통_첨부파일기본 저장 (AtchMapper.insertAtch) */
        INSERT INTO kids_own.TB_CA_M_ATCH
        (
             atch_file_sn
            ,menu_sn
            ,menu_type
            ,atch_file_uld_hr
            ,atch_file_use_yn
            ,atch_file_path
            ,atch_file_nm
            ,atch_file_extn_nm
            ,atch_file_cn
            ,atch_file_sz
            ,rgtr_id
            ,reg_dt

            ,mdfr_id
            ,mdfcn_dt

        )
        VALUES
        (
             #{atchFileSn}
            ,#{menuSn}
            ,#{menuType}
            ,#{atchFileUldHr}
            ,#{atchFileUseYn}
            ,#{atchFilePath}
            ,#{atchFileNm}
            ,#{atchFileExtnNm}
            ,#{atchFileCn}
            ,#{atchFileSz}
            ,#{rgtrId}
            ,now()

            ,#{mdfrId}
            ,now()

        )
        ON CONFLICT(atch_file_sn)
        DO UPDATE SET
             menu_sn = coalesce(excluded.menu_sn, kids_own.TB_CA_M_ATCH.menu_sn)
            ,menu_type = coalesce(excluded.menu_type, kids_own.TB_CA_M_ATCH.menu_type)
            ,atch_file_uld_hr = coalesce(excluded.atch_file_uld_hr, kids_own.TB_CA_M_ATCH.atch_file_uld_hr)
            ,atch_file_use_yn = coalesce(excluded.atch_file_use_yn, kids_own.TB_CA_M_ATCH.atch_file_use_yn)
            ,atch_file_path = coalesce(excluded.atch_file_path, kids_own.TB_CA_M_ATCH.atch_file_path)
            ,atch_file_nm = coalesce(excluded.atch_file_nm, kids_own.TB_CA_M_ATCH.atch_file_nm)
            ,atch_file_extn_nm = coalesce(excluded.atch_file_extn_nm, kids_own.TB_CA_M_ATCH.atch_file_extn_nm)
            ,atch_file_cn = coalesce(excluded.atch_file_cn, kids_own.TB_CA_M_ATCH.atch_file_cn)
            ,atch_file_sz = coalesce(excluded.atch_file_sz, kids_own.TB_CA_M_ATCH.atch_file_sz)
            ,mdfr_id = coalesce(excluded.mdfr_id, kids_own.TB_CA_M_ATCH.mdfr_id)
            ,mdfcn_dt = now()

    </insert>

    <delete id="deleteAtch" parameterType="AtchDVO">
        /* 공통_첨부파일기본 삭제 (AtchMapper.deleteAtch) */
        DELETE FROM kids_own.TB_CA_M_ATCH
        WHERE 1=1
        AND atch_file_sn = #{atchFileSn}
    </delete>

</mapper>