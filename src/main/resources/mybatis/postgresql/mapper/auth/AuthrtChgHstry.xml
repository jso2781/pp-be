<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.go.kids.domain.auth.mapper.AuthrtChgHstryMapper">

    <select id="getAuthrtChgHstry" parameterType="AuthrtChgHstryPVO" resultType="AuthrtChgHstryRVO" >
        /* 대국민포털_권한변경이력기본 조회 (AuthrtChgHstryMapper.getAuthrtChgHstry) */
        SELECT
             authrt_chg_sn
            ,authrt_cd
            ,menu_sn
            ,aplcn_trgt_type_cd
            ,chg_role_list_cn
            ,aplcn_trgt_nm
            ,chg_type_cd
            ,authrt_chg_rmrk_cn
            ,rgtr_id
            ,reg_dt

            ,mdfr_id
            ,mdfcn_dt

        FROM kids_own.TB_PP_M_AUTHRT_CHG_HSTRY
        WHERE 1=1
        AND authrt_chg_sn = #{authrtChgSn}
    </select>

    <insert id="insertAuthrtChgHstry" parameterType="AuthrtChgHstryPVO">
        /* 대국민포털_권한변경이력기본 입력 (AuthrtChgHstryMapper.insertAuthrtChgHstry) */
        INSERT INTO kids_own.TB_PP_M_AUTHRT_CHG_HSTRY
        (
             authrt_chg_sn
            ,authrt_cd
            ,menu_sn
            ,aplcn_trgt_type_cd
            ,chg_role_list_cn
            ,aplcn_trgt_nm
            ,chg_type_cd
            ,authrt_chg_rmrk_cn
            ,rgtr_id
            ,reg_dt

            ,mdfr_id
            ,mdfcn_dt

        )
        VALUES
        (
             #{authrtChgSn}
            ,#{authrtCd}
            ,#{menuSn}
            ,#{aplcnTrgtType}
            ,#{chgRoleList}
            ,#{aplcnTrgt}
            ,#{chgType}
            ,#{authrt_chg_rmrk_cn}
            ,#{rgtrId}
            ,now()

            ,#{mdfrId}
            ,now()

        )
    </insert>

    <update id="updateAuthrtChgHstry" parameterType="AuthrtChgHstryPVO">
        /* 대국민포털_권한변경이력기본 수정 (AuthrtChgHstryMapper.updateAuthrtChgHstry) */
        UPDATE kids_own.TB_PP_M_AUTHRT_CHG_HSTRY
        SET
             authrt_cd = coalesce(#{authrtCd}, authrt_cd)
            ,menu_sn = coalesce(#{menuSn}, menu_sn)
            ,aplcn_trgt_type_cd = coalesce(#{aplcnTrgtType}, aplcn_trgt_type_cd)
            ,chg_role_list_cn = coalesce(#{chgRoleList}, chg_role_list_cn)
            ,aplcn_trgt_nm = coalesce(#{aplcnTrgt}, aplcn_trgt_nm)
            ,chg_type_cd = coalesce(#{chgType}, chg_type_cd)
            ,authrt_chg_rmrk_cn = coalesce(#{authrt_chg_rmrk_cn}, authrt_chg_rmrk_cn)
            ,mdfr_id = coalesce(#{mdfrId}, mdfr_id)
            ,mdfcn_dt = now()

        WHERE 1=1
        AND authrt_chg_sn = #{authrtChgSn}
    </update>

    <insert id="saveAuthrtChgHstry" parameterType="AuthrtChgHstryPVO">
        /* 대국민포털_권한변경이력기본 저장 (AuthrtChgHstryMapper.insertAuthrtChgHstry) */
        INSERT INTO kids_own.TB_PP_M_AUTHRT_CHG_HSTRY
        (
             authrt_chg_sn
            ,authrt_cd
            ,menu_sn
            ,aplcn_trgt_type_cd
            ,chg_role_list_cn
            ,aplcn_trgt_nm
            ,chg_type_cd
            ,authrt_chg_rmrk_cn
            ,rgtr_id
            ,reg_dt

            ,mdfr_id
            ,mdfcn_dt

        )
        VALUES
        (
             #{authrtChgSn}
            ,#{authrtCd}
            ,#{menuSn}
            ,#{aplcnTrgtType}
            ,#{chgRoleList}
            ,#{aplcnTrgt}
            ,#{chgType}
            ,#{authrt_chg_rmrk_cn}
            ,#{rgtrId}
            ,now()

            ,#{mdfrId}
            ,now()

        )
        ON CONFLICT(authrt_chg_sn)
        DO UPDATE SET
             authrt_cd = coalesce(excluded.authrt_cd, kids_own.TB_PP_M_AUTHRT_CHG_HSTRY.authrt_cd)
            ,menu_sn = coalesce(excluded.menu_sn, kids_own.TB_PP_M_AUTHRT_CHG_HSTRY.menu_sn)
            ,aplcn_trgt_type_cd = coalesce(excluded.aplcn_trgt_type_cd, kids_own.TB_PP_M_AUTHRT_CHG_HSTRY.aplcn_trgt_type_cd)
            ,chg_role_list_cn = coalesce(excluded.chg_role_list_cn, kids_own.TB_PP_M_AUTHRT_CHG_HSTRY.chg_role_list_cn)
            ,aplcn_trgt_nm = coalesce(excluded.aplcn_trgt_nm, kids_own.TB_PP_M_AUTHRT_CHG_HSTRY.aplcn_trgt_nm)
            ,chg_type_cd = coalesce(excluded.chg_type_cd, kids_own.TB_PP_M_AUTHRT_CHG_HSTRY.chg_type_cd)
            ,authrt_chg_rmrk_cn = coalesce(excluded.authrt_chg_rmrk_cn, kids_own.TB_PP_M_AUTHRT_CHG_HSTRY.authrt_chg_rmrk_cn)
            ,mdfr_id = coalesce(excluded.mdfr_id, kids_own.TB_PP_M_AUTHRT_CHG_HSTRY.mdfr_id)
            ,mdfcn_dt = now()

    </insert>

    <delete id="deleteAuthrtChgHstry" parameterType="AuthrtChgHstryDVO">
        /* 대국민포털_권한변경이력기본 삭제 (AuthrtChgHstryMapper.deleteAuthrtChgHstry) */
        DELETE FROM kids_own.TB_PP_M_AUTHRT_CHG_HSTRY
        WHERE 1=1
        AND authrt_chg_sn = #{authrtChgSn}
    </delete>

</mapper>