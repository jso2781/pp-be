<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.go.kids.domain.exprt.mapper.ExprtTaskMapper">

    <select id="selectExprtInfo" parameterType="ExprtTaskPVO" resultType="ExprtTaskRVO" >
        /* 대국민포털_전문가내업무관리 전문가회원 정보 조회 (ExprtTaskMapper.selectExprtInfo) */
        SELECT ei.encpt_exprt_flnm
             , ei.aprv_stts_cd AS exprt_aprv_stts_code
             , (SELECT com_dtl_cd_nm
                FROM kids_own.TB_CA_C_DTL_CODE
                WHERE com_group_cd = 'PP4'
                  AND com_dtl_cd = ei.aprv_stts_cd) AS exprt_aprv_stts_label
             , ei.rjct_rsn
             , ei.exprt_no
             , ei.mbr_no
             , ii.inst_nm
             , ii.brno
             , (SELECT date_trunc('second', MAX(reg_dt))
                  FROM kids_own.tb_ca_l_sesn_log_info_mng
                 WHERE srvc_user_id = ei.rgtr_id) AS last_lgn_dt
         FROM kids_own.TB_PP_M_EXPRT_INFO ei
            , kids_own.TB_PP_M_INST ii
        WHERE ei.mbr_no = #{mbrNo}
          AND ii.del_yn = 'N'
          AND ei.brno = ii.brno
    </select>

    <select id="selectExprtTasks" parameterType="ExprtTaskPVO" resultType="ExprtTaskRVO" >
        /* 대국민포털_전문가내업무관리 전문가회원 업무 목록 조회 (ExprtTaskMapper.selectExprtTasks) */
        SELECT it.task_se_cd AS value
             , (SELECT com_dtl_cd_nm
                  FROM kids_own.TB_CA_C_DTL_CODE
                 WHERE com_group_cd = 'PP13'
                   AND com_dtl_cd = it.task_se_cd) AS label
             , et.aprv_stts_cd AS task_aprv_stts_code
             , (SELECT com_dtl_cd_nm
                FROM kids_own.TB_CA_C_DTL_CODE
                WHERE com_group_cd = 'PP4'
                  AND com_dtl_cd = et.aprv_stts_cd) AS task_aprv_stts_label
             , et.rjct_rsn
             , et.exprt_task_sn
             , it.bzmn_task_mng_no
          FROM kids_own.TB_PP_M_INST_TASK it
          LEFT OUTER JOIN kids_own.TB_PP_M_EXPRT_TASK et
            ON it.bzmn_task_mng_no = et.bzmn_task_mng_no
           AND et.exprt_no = #{exprtNo}
         WHERE it.brno = #{brno}
           AND it.use_yn = 'Y'
    </select>

    <delete id="deleteAllExprtTask" parameterType="ExprtTaskPVO">
        /* 대국민포털_전문가내업무관리 전문가회원 업무 전체 삭제 (ExprtTaskMapper.deleteAllExprtTask) */
        DELETE FROM kids_own.TB_PP_M_EXPRT_TASK
         WHERE exprt_no = #{exprtNo}
    </delete>

    <delete id="deleteExprtTask" parameterType="ExprtTaskPVO">
        /* 대국민포털_전문가내업무관리 전문가회원 업무 삭제 (ExprtTaskMapper.deleteExprtTask) */
        DELETE FROM kids_own.TB_PP_M_EXPRT_TASK
         WHERE exprt_task_sn = #{exprtTaskSn}
    </delete>

    <delete id="deleteExprtInfo" parameterType="ExprtTaskPVO">
        /* 대국민포털_전문가내업무관리 전문가회원 정보 삭제 (ExprtTaskMapper.deleteExprtInfo) */
        DELETE FROM kids_own.TB_PP_M_EXPRT_INFO
         WHERE exprt_no = #{exprtNo}
    </delete>

    <insert id="insertExprtTask" parameterType="ExprtTaskPVO">
        /* 대국민포털_전문가내업무관리 전문가회원 업무 입력 (ExprtTaskMapper.insertExprtTask) */
        INSERT INTO kids_own.TB_PP_M_EXPRT_TASK
        (
             exprt_task_sn
            ,exprt_no
            ,bzmn_task_mng_no
            ,aprv_stts_cd
            ,rgtr_id
            ,reg_dt
        )
        VALUES
        (
            nextval('kids_own.sq_pp_exprt_task_sn')
            ,#{exprtNo}
            ,#{bzmnTaskMngNo}
            ,'W'
            ,#{mbrId}
            ,CURRENT_TIMESTAMP
        )
    </insert>

</mapper>